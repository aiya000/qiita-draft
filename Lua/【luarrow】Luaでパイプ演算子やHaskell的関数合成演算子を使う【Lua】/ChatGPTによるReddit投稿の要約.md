# ã€luarrowã€‘Luaã§ãƒ‘ã‚¤ãƒ—æ¼”ç®—å­ã‚„Haskellçš„é–¢æ•°åˆæˆæ¼”ç®—å­ã‚’ä½¿ã†ã€Luaã€‘

## ã“ã¡ã‚‰ã«ã‚ˆã‚‹æŒ‡ç¤º

> https://www.reddit.com/r/lua/comments/1ojwll9/luarrow_pipelineoperator_and_haskellstyle/
>
> ã“ã‚Œã¯åƒ•ãŒä½œã£ãŸluarrow.luaã¨ã„ã†ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ã€åƒ•ã«ã‚ˆã‚‹ã‚µãƒ–Redditã¸ã®ã¯æŠ•ç¨¿ã§ã€ä»Šå›ã¯ãã®åå¿œã‚’è¸ã¾ãˆã¦Qiitaã®è¨˜äº‹ã‚’æ›¸ããŸã„ã€‚
> ã§ã‚‚ã“ã®æŠ•ç¨¿ã¸ã®ã‚³ãƒ¡ãƒ³ãƒˆã«ã¯ã€ã„ãã‚‰ã‹éæ¿€ãªã‚³ãƒ¡ãƒ³ãƒˆãŒã‚ã‚‹ã€‚
> ãŸã ã—ãã®ã†ã¡æ‰“å€’ãªæŒ‡æ‘˜ã¯å¼•ç”¨ã—ãŸã„ã€‚
>
> ãã‚Œã‚’è¸ã¾ãˆã¦ã€ã“ã®Redditã®æŠ•ç¨¿ã‚’è¦ç´„ã—ã¦ãã‚Œã‚‹ï¼Ÿ

## ChatGPTã«ã‚ˆã‚‹è¦ç´„

ã„ã„ã­ã€‚ä»¥ä¸‹ã€ã‚ãªãŸã® Reddit æŠ•ç¨¿ï¼ˆluarrow.luaï¼‰ã¨ã€ãã‚Œã«å¯¾ã™ã‚‹ r/lua ã§ã®åå¿œã®è¦ç‚¹ã‚’ã¾ã¨ã‚ã‚‹ â€” å¾Œã§ Qiita è¨˜äº‹ã‚’æ›¸ãã¨ãã®ã€Œæ¦‚è¦ï¼‹å¼•ç”¨ãƒã‚¿ã€ç”¨ã€‚

---

## âœ… æŠ•ç¨¿ã®ä¸»å¼µå†…å®¹ï¼ˆã‚ãªãŸã®èª¬æ˜ï¼‰

* `luarrow.lua` ã¯ Lua ã«ãƒ‘ã‚¤ãƒ—ã‚¹ã‚¿ã‚¤ãƒ«ï¼Haskellã‚¹ã‚¿ã‚¤ãƒ«ã®é–¢æ•°åˆæˆã‚’ã‚‚ãŸã‚‰ã™ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã€‚å…·ä½“çš„ã«ã¯ï¼š

  * **ãƒ‘ã‚¤ãƒ—å½¢å¼**: `x % arrow(h) ^ arrow(g) ^ arrow(f)` â€” ä»–è¨€èªã® `x |> h |> g |> f` ã«ç›¸å½“ã€‚ ([Reddit][1])
  * **Haskellé¢¨é–¢æ•°åˆæˆ**: `fun(f) * fun(g) * fun(h) % x` â€” Haskell ã® `f . g . h $ x` ã«è¿‘ã„ã€‚ ([Reddit][1])

* ç›®çš„ã¯ã€Œãƒã‚¹ãƒˆã•ã‚ŒãŸé–¢æ•°å‘¼ã³å‡ºã— `f(g(h(x)))` ã®å¯èª­æ€§æ”¹å–„ã€ã€ŒLua ã«ãŠã‘ã‚‹é–¢æ•°å‹ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã£ã½ã•ã®æ¢æ±‚ã€ã€‚ ([Reddit][1])

* æ€§èƒ½é¢ã®ä¸»å¼µã¨ã—ã¦ã€LuaJIT ç’°å¢ƒã§ã¯ã€Œã»ã¼ã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰ãªã—ã€ã€é€šå¸¸ã® Lua ã§ã‚‚ã€Œå¤§åŠã®ç”¨é€”ã§ã¯ååˆ†é«˜é€Ÿã€ã¨ã—ã¦ã„ã‚‹ã€‚ ([Reddit][1])

---

## ğŸ“¬ ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã®åå¿œ

### âœ… è³›æˆãƒ»å¥½æ„çš„ãªåå¿œ

* æŠ•ç¨¿ã¯ +14 æŠ•ç¥¨ã‚’å¾—ã¦ãŠã‚Šã€ä¸€å®šã®æ³¨ç›®ã¨è©•ä¾¡ã‚’å—ã‘ã¦ã„ã‚‹ã€‚ ([Reddit][1])
* é–¢æ•°åˆæˆã‚ã‚‹ã„ã¯ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ã‚¯ãªè¨˜æ³•ã‚’æ±‚ã‚ã‚‹ Lua ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã¨ã£ã¦ã€ã€Œãƒã‚¹ãƒˆåœ°ç„ã€ã‚’é˜²ãã€ã‚³ãƒ¼ãƒ‰ã®å¯èª­æ€§ã‚’ä¸Šã’ã‚‹ã‚¢ã‚¤ãƒ‡ã‚¢ã¨ã—ã¦ç†è§£ã•ã‚ŒãŸã€‚

### âš ï¸ å¦å®šãƒ»æ‡¸å¿µãƒ»æ‰¹åˆ¤çš„ãªæŒ‡æ‘˜

> â€œThe â€œpipeline operatorâ€ workaround **breaks** if `x` defines the `%` metamethod (which custom numeric types very often do), because `x`'s metamethod will be called, which it should not be.â€ ([Reddit][1])
> â€” ã“ã®æ–¹å¼ã§ã¯ã€ã‚‚ã— `x` ãŒ `%` ã«å¯¾å¿œã™ã‚‹ metamethod ã‚’æŒã¤å‹ï¼ˆãŸã¨ãˆã°ç‹¬è‡ªã®æ•°å€¤å‹ãªã©ï¼‰ã ã£ãŸå ´åˆã«ã€æ„å›³ã—ãªã„æŒ™å‹•ã‚’èµ·ã“ã™å¯èƒ½æ€§ãŒã‚ã‚‹ã€ã¨ã„ã†æ·±åˆ»ãªæ¬ ç‚¹ã‚’æŒ‡æ‘˜ã™ã‚‹ã‚³ãƒ¡ãƒ³ãƒˆã€‚ ([Reddit][1])

---

## âœï¸ ã‚ãªãŸã«ã¨ã£ã¦ä½¿ãˆã‚‹ã€Œå¼•ç”¨ãƒã‚¿ã€ã®ã‚¢ã‚¤ãƒ‡ã‚¢

Qiita è¨˜äº‹ã§ã€Œè­°è«–ã®æ•´ç†ã€ã€Œ pros & consã€ã®æ§‹æˆã«ã™ã‚‹ãªã‚‰ã€æ¬¡ã®ã‚ˆã†ãªå½¢å¼ãŒä½¿ã„ã‚„ã™ã„ã¨æ€ã†ï¼š

* **è³›æˆæ´¾ã®è«–ç‚¹**

  * ãƒã‚¹ãƒˆã•ã‚ŒãŸé–¢æ•°å‘¼ã³å‡ºã—ã«æ¯”ã¹ã¦å¯èª­æ€§ãŒä¸ŠãŒã‚‹
  * Lua ã§ã‚‚é–¢æ•°åˆæˆï¼é–¢æ•°å‹ã‚¹ã‚¿ã‚¤ãƒ«ã‚’è©¦ã›ã‚‹ â€” ã‚ãªãŸã®ã‚ˆã†ã« Haskellï¼FP ãŒå¥½ããªäººã«ã¯é¦´æŸ“ã¿ã‚„ã™ã„

* **æ‰¹åˆ¤æ´¾ã®è«–ç‚¹ï¼ˆæ³¨æ„ç‚¹ï¼‰**

  * `%` ã‚’ä½¿ã†ãƒ‘ã‚¤ãƒ—æ§‹æ–‡ã¯ metamethod ã‚’æŒã¤å‹ã«å¯¾ã—ã¦å±é™ºï¼ˆæ„å›³ã—ãªã„å‹•ä½œï¼‰ã«ãªã‚‹å¯èƒ½æ€§ã‚ã‚Š

---

## ğŸ¯ åƒ•å€‹äººã®è¦‹è§£ï¼ˆã‚ãªãŸã®æ–‡è„ˆè¾¼ã¿ã§ï¼‰

ã‚ãªãŸã¯ã‚‚ã¨ã‚‚ã¨ Haskellï¼Idrisï¼PureScript ã‚ãŸã‚Šã®é–¢æ•°å‹ã‚¹ã‚¿ã‚¤ãƒ«ãŒå¥½ãã§ã€ã‹ã¤ Lua ã‚’è§¦ã‚‹æ©Ÿä¼šãŒã‚ã‚‹ãªã‚‰ã€ã“ã® `luarrow` çš„ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã¯ã€Œè©¦ã—ã¦ã¿ã‚‹ä¾¡å€¤ã‚ã‚Šã€ã ã¨æ€ã†ã€‚ç‰¹ã«ã€ã‚ãªãŸã®ã‚ˆã†ã«å‹ã‚·ã‚¹ãƒ†ãƒ ã‚„é–¢æ•°åˆæˆã«ç†è§£ãŒã‚ã‚‹ãªã‚‰ã€ã€Œã‚³ãƒ¼ãƒ‰ã®ç¾ã—ã•ãƒ»å¯èª­æ€§ã€ã¨ã„ã†è¦³ç‚¹ã§ãƒ¡ãƒªãƒƒãƒˆã¯å¤§ãã„ã€‚

---

## âœ… â€œè¦ç´„â€ â€” 1æ–‡ã§ã¾ã¨ã‚ã‚‹ãªã‚‰

ã€Œ`luarrow.lua` ã¯ Lua ã«ãƒ‘ã‚¤ãƒ—æ¼”ç®—å­ï¼é–¢æ•°åˆæˆè¨˜æ³•ã‚’å°å…¥ã™ã‚‹ã“ã¨ã§ã€ãƒã‚¹ãƒˆåœ°ç„ã‚’é¿ã‘ã¦é–¢æ•°å‹é¢¨ã«æ›¸ã‘ã‚‹ã‚ˆã†ã«ã™ã‚‹è©¦ã¿ã€‚ã€

---

ã‚‚ã—ã‚ˆã‘ã‚Œã°ã€**Qiita ç”¨ã®æ§‹æˆæ¡ˆï¼ˆã‚»ã‚¯ã‚·ãƒ§ãƒ³æ§‹æˆï¼‹è¦‹å‡ºã—ä»˜ãï¼‰** ã‚’åƒ•ãŒä¸‹æ›¸ãã—ã¦ãŠãã‚ˆ â€” ã‚ãªãŸã®ã‚¹ã‚¿ã‚¤ãƒ«ï¼å¥½ã¿ã«ã‚ã‚ã›ã¦ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã§ãã‚‹ã€‚ã‚„ã£ã¦ã¿ã‚‹ï¼Ÿ

[1]: https://www.reddit.com/r/lua/comments/1ojwll9/luarrow_pipelineoperator_and_haskellstyle/ "[luarrow] Pipeline-operator and Haskell-style function composition, for Lua (like: `x |> h |> g |> f` and `f . g . h $ x`)"
